## ğŸ¯ éŒ¯èª¤è™•ç†æ¦‚å¿µ

SvelteKit çš„éŒ¯èª¤è™•ç†ç³»çµ±æœƒæ ¹æ“šä¸‰å€‹é—œéµå› ç´ ä¾†æ±ºå®šå¦‚ä½•è™•ç†éŒ¯èª¤ï¼š
- **éŒ¯èª¤ç™¼ç”Ÿçš„ä½ç½®**ï¼ˆåœ¨å“ªå€‹å‡½æ•¸æˆ–çµ„ä»¶ä¸­ï¼‰
- **éŒ¯èª¤çš„é¡å‹**ï¼ˆé æœŸ vs æ„å¤–ï¼‰
- **è«‹æ±‚çš„æ€§è³ª**ï¼ˆæ˜¯é é¢è«‹æ±‚é‚„æ˜¯ API è«‹æ±‚ï¼‰

## ğŸ“ éŒ¯èª¤å°è±¡çš„åŸºæœ¬çµæ§‹

æ‰€æœ‰éŒ¯èª¤åœ¨ SvelteKit ä¸­éƒ½è¡¨ç¤ºç‚ºä¸€å€‹å°è±¡ï¼Œé è¨­åŒ…å«ï¼š
```javascript
{ message: string }
```

æ‚¨å¯ä»¥æ“´å±•é€™å€‹å°è±¡ï¼Œæ·»åŠ æ›´å¤šå±¬æ€§å¦‚ `code`ã€`id` ç­‰ã€‚

---

## ğŸ¯ é æœŸéŒ¯èª¤ï¼ˆExpected Errorsï¼‰

### ä»€éº¼æ˜¯é æœŸéŒ¯èª¤ï¼Ÿ
é æœŸéŒ¯èª¤æ˜¯**é–‹ç™¼è€…ä¸»å‹•æ‹‹å‡ºçš„éŒ¯èª¤**ï¼Œç”¨æ–¼è™•ç†å·²çŸ¥çš„ç•°å¸¸æƒ…æ³ã€‚

### å¦‚ä½•å‰µå»ºé æœŸéŒ¯èª¤

````javascript
import { error } from '@sveltejs/kit';
import * as db from '$lib/server/database';

export async function load({ params }) {
  const post = await db.getPost(params.slug);

  if (!post) {
    // æ‹‹å‡º 404 éŒ¯èª¤
    error(404, {
      message: 'æœªæ‰¾åˆ°'
    });
  }

  return { post };
}
````

### éŒ¯èª¤è™•ç†æµç¨‹
1. **æ‹‹å‡ºç•°å¸¸**ï¼šä½¿ç”¨ `error()` å‡½æ•¸
2. **SvelteKit æ•ç²**ï¼šè‡ªå‹•æ•ç²ç•°å¸¸
3. **è¨­ç½®ç‹€æ…‹ç¢¼**ï¼šè¨­ç½® HTTP ç‹€æ…‹ç¢¼ï¼ˆå¦‚ 404ï¼‰
4. **æ¸²æŸ“éŒ¯èª¤é é¢**ï¼šé¡¯ç¤º `+error.svelte` çµ„ä»¶

### éŒ¯èª¤é é¢çµ„ä»¶

````svelte
<script>
  import { page } from '$app/state';
</script>

<h1>{page.error.message}</h1>
````

### æ·»åŠ è‡ªå®šç¾©å±¬æ€§

````javascript
error(404, {
  message: 'æœªæ‰¾åˆ°',
  code: 'NOT_FOUND'
});
````

### ç°¡åŒ–å¯«æ³•

````javascript
// ç°¡åŒ–ç‰ˆæœ¬
error(404, 'æœªæ‰¾åˆ°');

// ç­‰åŒæ–¼
error(404, { message: 'æœªæ‰¾åˆ°' });
````

---

## âš ï¸ æ„å¤–éŒ¯èª¤ï¼ˆUnexpected Errorsï¼‰

### ä»€éº¼æ˜¯æ„å¤–éŒ¯èª¤ï¼Ÿ
æ„å¤–éŒ¯èª¤æ˜¯**ç³»çµ±é‹è¡Œæ™‚ç™¼ç”Ÿçš„ç•°å¸¸**ï¼Œå¦‚è³‡æ–™åº«é€£æ¥å¤±æ•—ã€ç¨‹å¼ç¢¼éŒ¯èª¤ç­‰ã€‚

### å®‰å…¨ç‰¹æ€§
- **ä¸æœƒæš´éœ²æ•æ„Ÿä¿¡æ¯**çµ¦ç”¨æˆ¶
- éŒ¯èª¤è©³æƒ…åªåœ¨ä¼ºæœå™¨ç«¯è¨˜éŒ„
- ç”¨æˆ¶åªæœƒçœ‹åˆ°é€šç”¨éŒ¯èª¤æ¶ˆæ¯

### é è¨­è¡Œç‚º
```json
{ "message": "å…§éƒ¨éŒ¯èª¤" }
```

### è‡ªå®šç¾©è™•ç†
å¯ä»¥é€šé `handleError` hook ä¾†æ·»åŠ è‡ªå®šç¾©é‚è¼¯ï¼š
- ç™¼é€éŒ¯èª¤å ±å‘Šåˆ°ç›£æ§æœå‹™
- è¿”å›è‡ªå®šç¾©éŒ¯èª¤å°è±¡
- è¨˜éŒ„è©³ç´°æ—¥èªŒ

---

## ğŸ“¤ éŒ¯èª¤éŸ¿æ‡‰æ©Ÿåˆ¶

### éŸ¿æ‡‰é¡å‹
SvelteKit æœƒæ ¹æ“šè«‹æ±‚çš„ `Accept` é ­æ±ºå®šéŸ¿æ‡‰æ ¼å¼ï¼š
- **HTML è«‹æ±‚**ï¼šè¿”å›éŒ¯èª¤é é¢
- **JSON è«‹æ±‚**ï¼šè¿”å› JSON éŒ¯èª¤å°è±¡

### è‡ªå®šç¾©å›é€€éŒ¯èª¤é é¢

````html
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>%sveltekit.error.message%</title>
	</head>
	<body>
		<h1>æˆ‘çš„è‡ªå®šç¾©éŒ¯èª¤é é¢</h1>
		<p>ç‹€æ…‹ï¼š%sveltekit.status%</p>
		<p>æ¶ˆæ¯ï¼š%sveltekit.error.message%</p>
	</body>
</html>
````

### éŒ¯èª¤é‚Šç•Œè¦å‰‡

| éŒ¯èª¤ä½ç½® | æ¸²æŸ“çš„éŒ¯èª¤é é¢ |
|---------|---------------|
| `load` å‡½æ•¸ | æœ€è¿‘çš„ `+error.svelte` |
| å¸ƒå±€ `load` å‡½æ•¸ | ä¸Šå±¤çš„ `+error.svelte` |
| æ ¹å¸ƒå±€ `load` | å›é€€éŒ¯èª¤é é¢ |

---

## ğŸ”’ TypeScript é¡å‹å®‰å…¨

### å®šç¾©è‡ªå®šç¾©éŒ¯èª¤æ¥å£

````typescript
declare global {
  namespace App {
    interface Error {
      code: string;
      id: string;
    }
  }
}

export {};
````

### é‡è¦æ³¨æ„äº‹é …
- æ¥å£å§‹çµ‚åŒ…å« `message: string` å±¬æ€§
- å¿…é ˆåœ¨ TypeScript å¯è¦‹çš„ä½ç½®è²æ˜
- é€šå¸¸æ”¾åœ¨ `src/app.d.ts` æ–‡ä»¶ä¸­

---

## ğŸŒŸ å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹

### å®Œæ•´çš„éŒ¯èª¤è™•ç†æµç¨‹

````javascript
import { error, json } from '@sveltejs/kit';

export async function GET({ params }) {
  try {
    const user = await getUserById(params.id);
    
    if (!user) {
      // é æœŸéŒ¯èª¤
      error(404, {
        message: 'ç”¨æˆ¶ä¸å­˜åœ¨',
        code: 'USER_NOT_FOUND'
      });
    }
    
    return json(user);
  } catch (err) {
    // æ„å¤–éŒ¯èª¤æœƒè¢« handleError hook è™•ç†
    throw err;
  }
}
````

### éŒ¯èª¤é é¢è™•ç†ä¸åŒç‹€æ…‹

````svelte
<script>
  import { page } from '$app/state';
  
  $: errorCode = page.status;
  $: errorMessage = page.error.message;
</script>

{#if errorCode === 404}
  <h1>é é¢æœªæ‰¾åˆ°</h1>
  <p>æŠ±æ­‰ï¼Œæ‚¨è¨ªå•çš„é é¢ä¸å­˜åœ¨ã€‚</p>
{:else if errorCode >= 500}
  <h1>ä¼ºæœå™¨éŒ¯èª¤</h1>
  <p>ä¼ºæœå™¨ç™¼ç”Ÿå•é¡Œï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>
{:else}
  <h1>ç™¼ç”ŸéŒ¯èª¤</h1>
  <p>{errorMessage}</p>
{/if}
````

é€™å€‹éŒ¯èª¤è™•ç†ç³»çµ±æä¾›äº†å®Œæ•´ä¸”å®‰å…¨çš„éŒ¯èª¤ç®¡ç†ï¼Œç¢ºä¿ç”¨æˆ¶é«”é©—çš„åŒæ™‚ä¿è­·æ•æ„Ÿä¿¡æ¯ä¸è¢«æ´©éœ²ã€‚