# Context
Context 是 Svelte 提供的一種機制，讓你可以在組件樹中向下傳遞數據，而不需要通過 props 一層層傳遞（解決 prop drilling 問題）。

狀態不是全局的，而是限定在組件範圍內。這樣就可以安全地在服務端渲染組件而不會泄露狀態
很明顯，狀態不是全局的，而是限定在特定的組件樹中，因此不能在應用的其他部分使用

> [!NOTE] `setContext` / `getContext` 必須在組件初始化期間調用。

父組件 `App.svelte`
```svelte
<script>
  import { setContext } from 'svelte';
  import Child from './Child.svelte';
  
  const user = {
    name: '小明',
    email: 'ming@example.com'
  };
  
  // 設定 context
  setContext('user', user);
</script>

<main>
  <h1>主應用</h1>
  <Child />
</main>
```

子組件 `Child.svelte`
```svelte
<script>
  import { getContext } from 'svelte';
  import GrandChild from './GrandChild.svelte';
  
  // 獲取 context
  const user = getContext('user');
</script>

<div>
  <h2>子組件</h2>
  <p>用户：{user.name}</p>
  <GrandChild />
</div>
```

更深層的組件中使用 `GrandChild.svelte`
```svelte
<script>
  import { getContext } from 'svelte';
  
  const user = getContext('user');
</script>

<div>
  <h3>孫組件</h3>
  <p>郵箱：{user.email}</p>
</div>
```

Context 本身不是響應式的。如果你需要 Context 中的響應式值，你可以傳遞一個 `$state` 對象到 Context 中，其屬性 將會 是響應式的。

`Parent.svelte`
```svelte
<script>
	import { setContext } from 'svelte';

	let value = $state({ count: 0 });
	setContext('counter', value);
</script>

<button onclick={() => value.count++}>增加</button>

```
`Child.svelte`
```svelte
<script>
	import { getContext } from 'svelte';

	const value = getContext('counter');
</script>

<p>計數為 {value.count}</p>
```

要檢查給定的 `key` 是否已在父組件的 Context 中設置，可以使用 `hasContext。`

```svelte
<script>
	import { hasContext } from 'svelte';

	if (hasContext('key')) {
		// 執行某些操作
	}
</script>
```

可以使用 `getAllContexts` 獲取屬於最近父組件的整個 Context 映射。這在你以編程方式創建組件並想要將現有 Context 傳遞給它時很有用。

```svelte
<script>
	import { getAllContexts } from 'svelte';

	const contexts = getAllContexts();
</script>
```

### Context 進階用法
使用 Symbol 作為 key (推薦)
`context.js`
```js
export const USER_CONTEXT = Symbol('user');
```

`App.svelte`
```svelte
<script>
  import { setContext } from 'svelte';
  import { USER_CONTEXT } from './context.js';
  
  setContext(USER_CONTEXT, user);
</script>
```

`Child.svelte`
```svelte
<script>
  import { getContext } from 'svelte';
  import { USER_CONTEXT } from './context.js';
  
  const user = getContext(USER_CONTEXT);
</script>
```