# Stores

### When to use stores
`state.svelte.js`
```js
export const userState = $state({
  name: 'name'
});
```

`App.svelte`
```svelte
<script>
  import { userState } from './state.svelte.js';
</script>

<p>用户名: {userState.name}</p>
<button onclick={() => {
  userState.name = '新名字';
}}>
  修改名字
</button>
```

## svelte/store
### writable
可以創建一個從“外部”組件設置值的 store。store 是一個額外帶有
`set` 和 `update` 方法的對象。

`set` 是一個方法，它接受一個參數，該參數是要設置的值。如果 store 值與參數值不相等，則 store 值將設置為參數值。

`update` 是一個方法，它接受一個參數，該參數是一個回調函數。回調函數以現有的 store 值作為其參數,並返回要設置到 store 中的新值。

`stores.js`
```js
import { writable } from 'svelte/store';

// 創建一個 writable store
const count = writable(0);
```
`App.svelte`
```svelte
<script>
import { count } from './stores.js';

// 訂閲 store 的變化
count.subscribe(value => {
    console.log('count:', value);
});

// 更新值
count.set(5);             // 直接設定值
count.update(n => n + 1); // 基於當前值更新
</script>
```

### readable
`stores.js`
```js
import { readable } from 'svelte/store';

const time = readable(new Date(), (set) => {
  set(new Date());

  const interval = setInterval(() => {
    set(new Date());
  }, 1000);

  return () => clearInterval(interval);
});

const ticktock = readable('tick', (set, update) => {
  const interval = setInterval(() => {
    update((sound) => (sound === 'tick' ? 'tock' : 'tick'));
  }, 1000);

  return () => clearInterval(interval);
});
```

### derived
基於其他 store 計算出的值：
```svelte
<script>
  import { derived } from 'svelte/store';
  import { count } from './stores.js';
  
  const doubled = derived(count, $count => $count * 2);
  
  // 也可以依賴多個 store
  const sum = derived([a, b], ([$a, $b]) => $a + $b);
</script>
```

### readonly
將已存在的 writable store 轉換為只讀版本：
`stores.js`
```js
import { writable, readonly } from 'svelte/store';

// 創建一個 writable store
const _count = writable(0);

// 導出只讀版本
export const count = readonly(_count);

// 導出修改方法
export function increment() {
    _count.update(n => n + 1);
}

export function decrement() {
    _count.update(n => n - 1);
}
```

### get
直接取得 store 當前值的方法：
```svelte
<script>
  import { get } from 'svelte/store';
  import { count } from './stores.js';
  
  // 直接取得當前值
  const currentCount = get(count);
  console.log(currentCount); // 例如：5
  
  // 在函數中使用
  function logCount() {
      console.log('當前計數:', get(count));
  }
</script>
```


## Store contract
```ts
store = { subscribe: (subscription: (value: any) => void) => (() => void), set?: (value: any) => void }
```
可以通過實現 store contract 創建自己的 store ，而不依賴於 svelte/store：